const stumge_key_up=0,stumge_key_down=1,stumge_key_left=2,stumge_key_right=3,stumge_key_button_1=4,stumge_key_button_2=5,stumge_key_select=6,stumge_key_start=7,stumge_width=160,stumge_height=144;class stumge_sprite{constructor(t,e=0,s=0){this.original_data=Array.from(t),this.data=Array.from(t),this.x=e,this.y=s}_rotate_step(){const t=this.data.length,e=this.data[0].length;let s=new Array(e);for(let i=0;i<e;i++){s[i]=new Array(t);for(let e=0;e<t;e++)s[i][e]=this.data[t-1-e][i]}return s}rotate(t=0){this.data=Array.from(this.original_data);for(let e=1;e<=t;e++)this.data=this._rotate_step()}horizontalFlip(){const t=this.data.length;let e=new Array(t);for(let s=0;s<t;s++){let t=this.data[s].length;e[s]=new Array(t);for(let i=0;i<t;i++){let a=t-1-i;e[s][a]=this.data[s][i]}}this.data=Array.from(e)}verticalFlip(){const t=this.data.length;let e=new Array(t);for(let s=0;s<t;s++){let i=this.data[s].length,a=t-1-s;e[a]=new Array(i);for(let t=0;t<i;t++)e[a][t]=this.data[s][t]}this.data=Array.from(e)}getCopy(){return new stumge_sprite(this.data,this.x,this.y)}getWidth(){let t=0;for(let e=0;e<this.data.length;e++)this.data[e].length>t&&(t=this.data[e].length);return t}getHeight(){return this.data.length}collidesWith(t){return t instanceof stumge_sprite&&(this.x<t.x+t.getWidth()&&this.x+this.getWidth()>t.x&&this.y<t.y+t.getHeight()&&this.getHeight()+this.y>t.y)}}class stumge{constructor(){document.addEventListener("keydown",this.keyDown.bind(this),!1),document.addEventListener("keyup",this.keyUp.bind(this),!1),this.keyboard_state=[0,0,0,0,0,0,0,0],this.screen=new Array(stumge_width*stumge_height).fill(3),this.engine_canvas=null,this.engine_shadow_canvas=null,this.engine_context=null,this.engine_shadow_context=null,this.update_function=null,this.scale=null,this.frame_count=0,this.palette=[{r:15,g:56,b:15,a:255},{r:48,g:98,b:48,a:255},{r:139,g:172,b:15,a:255},{r:155,g:188,b:15,a:255}],this.font={A:new stumge_sprite([[-1,0,0,0,0,-1],[0,-1,-1,0,0,0],[0,-1,-1,0,0,0],[0,0,0,0,0,0],[0,-1,-1,0,0,0],[0,-1,-1,0,0,0]]),B:new stumge_sprite([[0,0,0,0,0,-1],[0,0,-1,-1,0,0],[0,0,0,0,0,-1],[0,0,-1,-1,0,0],[0,0,-1,-1,0,0],[0,0,0,0,0,-1]]),C:new stumge_sprite([[-1,0,0,0,0,-1],[0,0,-1,-1,0,0],[0,0,-1,-1,-1,-1],[0,0,-1,-1,-1,-1],[0,0,-1,-1,0,0],[-1,0,0,0,0,-1]]),D:new stumge_sprite([[0,0,0,0,0,-1],[0,-1,-1,0,0,0],[0,-1,-1,0,0,0],[0,-1,-1,0,0,0],[0,-1,-1,0,0,0],[0,0,0,0,0,-1]]),E:new stumge_sprite([[0,0,0,0,0,0],[0,0,-1,-1,-1,-1],[0,0,0,0,0,-1],[0,0,-1,-1,-1,-1],[0,0,-1,-1,-1,-1],[0,0,0,0,0,0]]),F:new stumge_sprite([[0,0,0,0,0,0],[0,0,-1,-1,-1,-1],[0,0,-1,-1,-1,-1],[0,0,0,0,0,-1],[0,0,-1,-1,-1,-1],[0,0,-1,-1,-1,-1]]),G:new stumge_sprite([[-1,0,0,0,0,-1],[0,0,-1,-1,0,0],[0,0,-1,-1,-1,-1],[0,0,-1,0,0,0],[0,0,-1,-1,0,0],[-1,0,0,0,0,0]]),H:new stumge_sprite([[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0],[0,0,0,0,0,0],[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0]]),I:new stumge_sprite([[-1,0,0,0,0,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,0,0,0,0,-1]]),J:new stumge_sprite([[-1,-1,0,0,0,0],[-1,-1,-1,0,0,-1],[-1,-1,-1,0,0,-1],[0,0,-1,0,0,-1],[0,0,-1,0,0,-1],[-1,0,0,0,-1,-1]]),K:new stumge_sprite([[0,0,-1,-1,0,0],[0,0,-1,0,0,-1],[0,0,0,0,-1,-1],[0,0,0,0,-1,-1],[0,0,-1,0,0,-1],[0,0,-1,-1,0,0]]),L:new stumge_sprite([[0,0,-1,-1,-1,-1],[0,0,-1,-1,-1,-1],[0,0,-1,-1,-1,-1],[0,0,-1,-1,-1,-1],[0,0,-1,-1,-1,-1],[0,0,0,0,0,0]]),M:new stumge_sprite([[0,-1,-1,-1,0,0],[0,0,-1,0,0,0],[0,0,0,0,0,0],[0,-1,0,-1,0,0],[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0]]),N:new stumge_sprite([[0,-1,-1,-1,0,0],[0,0,-1,-1,0,0],[0,0,0,-1,0,0],[0,-1,0,0,0,0],[0,-1,-1,0,0,0],[0,-1,-1,-1,0,0]]),O:new stumge_sprite([[-1,0,0,0,0,-1],[0,0,-1,-1,0,0],[0,0,-1,-1,0,0],[0,0,-1,-1,0,0],[0,0,-1,-1,0,0],[-1,0,0,0,0,-1]]),P:new stumge_sprite([[0,0,0,0,0,-1],[0,0,-1,-1,0,0],[0,0,-1,-1,0,0],[0,0,0,0,0,-1],[0,0,-1,-1,-1,-1],[0,0,-1,-1,-1,-1]]),Q:new stumge_sprite([[-1,0,0,0,0,-1],[0,0,-1,-1,-1,0],[0,0,-1,-1,-1,0],[0,0,-1,0,-1,0],[0,0,-1,-1,0,-1],[-1,0,0,0,-1,0]]),R:new stumge_sprite([[0,0,0,0,0,-1],[0,0,-1,-1,0,0],[0,0,-1,-1,0,0],[0,0,0,0,0,-1],[0,0,-1,0,-1,-1],[0,0,-1,-1,0,0]]),S:new stumge_sprite([[-1,0,0,0,0,-1],[0,0,-1,-1,-1,-1],[-1,0,0,0,0,-1],[-1,-1,-1,0,0,0],[0,-1,-1,0,0,0],[-1,0,0,0,0,-1]]),T:new stumge_sprite([[0,0,0,0,0,0],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1]]),U:new stumge_sprite([[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0],[0,-1,-1,0,0,0],[-1,0,0,0,0,-1]]),V:new stumge_sprite([[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0],[-1,0,-1,0,0,-1],[-1,-1,0,0,-1,-1]]),W:new stumge_sprite([[0,-1,-1,-1,0,0],[0,-1,-1,-1,0,0],[0,-1,0,-1,0,0],[0,0,0,0,0,0],[0,0,-1,0,0,0],[0,-1,-1,-1,0,0]]),X:new stumge_sprite([[0,-1,-1,-1,0,0],[-1,0,-1,0,0,-1],[-1,-1,0,0,-1,-1],[-1,0,0,0,-1,-1],[0,0,-1,-1,0,-1],[0,-1,-1,-1,-1,0]]),Y:new stumge_sprite([[0,0,-1,-1,0,0],[0,0,-1,-1,0,0],[-1,0,0,0,0,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1]]),Z:new stumge_sprite([[0,0,0,0,0,0],[-1,-1,-1,0,0,0],[-1,-1,0,0,0,-1],[-1,0,0,0,-1,-1],[0,0,0,-1,-1,-1],[0,0,0,0,0,0]]),0:new stumge_sprite([[-1,0,0,0,0,-1],[0,0,-1,-1,0,0],[0,0,-1,0,0,0],[0,0,0,-1,0,0],[0,0,-1,-1,0,0],[-1,0,0,0,0,-1]]),1:new stumge_sprite([[-1,-1,0,0,-1,-1],[-1,0,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,0,0,0,0,-1]]),2:new stumge_sprite([[-1,0,0,0,0,-1],[0,-1,-1,0,0,0],[-1,-1,-1,0,0,0],[-1,0,0,0,0,-1],[0,0,0,-1,-1,-1],[0,0,0,0,0,0]]),3:new stumge_sprite([[0,0,0,0,0,-1],[-1,-1,-1,0,0,0],[-1,0,0,0,0,-1],[-1,-1,-1,0,0,0],[-1,-1,-1,0,0,0],[0,0,0,0,0,-1]]),4:new stumge_sprite([[-1,0,0,0,0,-1],[0,0,-1,0,0,-1],[0,-1,-1,0,0,-1],[0,-1,-1,0,0,-1],[0,0,0,0,0,0],[-1,-1,-1,0,0,-1]]),5:new stumge_sprite([[0,0,0,0,0,-1],[0,0,-1,-1,-1,-1],[0,0,0,0,0,-1],[-1,-1,-1,0,0,0],[0,-1,-1,0,0,0],[-1,0,0,0,0,-1]]),6:new stumge_sprite([[-1,0,0,0,0,-1],[0,0,-1,-1,-1,-1],[0,0,0,0,0,-1],[0,0,-1,-1,0,0],[0,0,-1,-1,0,0],[-1,0,0,0,0,-1]]),7:new stumge_sprite([[0,0,0,0,0,0],[-1,-1,-1,-1,0,0],[-1,-1,-1,0,0,-1],[-1,-1,0,0,-1,-1],[-1,0,0,0,-1,-1],[-1,0,0,0,-1,-1]]),8:new stumge_sprite([[-1,0,0,0,0,-1],[0,-1,-1,0,0,0],[-1,0,0,0,0,-1],[0,-1,-1,0,0,0],[0,-1,-1,0,0,0],[-1,0,0,0,0,-1]]),9:new stumge_sprite([[-1,0,0,0,0,-1],[0,-1,-1,0,0,0],[0,-1,-1,0,0,0],[-1,0,0,0,0,0],[-1,-1,-1,0,0,0],[-1,0,0,0,0,-1]]),".":new stumge_sprite([[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1]]),",":new stumge_sprite([[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,-1,0,-1,-1],[-1,-1,0,-1,-1,-1]]),";":new stumge_sprite([[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,0,0,-1,-1,-1]]),":":new stumge_sprite([[-1,-1,-1,-1,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1]]),"'":new stumge_sprite([[-1,-1,0,0,-1,-1],[-1,-1,0,0,-1,-1],[-1,-1,-1,0,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1]]),"!":new stumge_sprite([[-1,-1,0,0,0,-1],[-1,-1,0,0,0,-1],[-1,-1,0,0,0,-1],[-1,-1,0,0,0,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,0,0,0,-1]]),'"':new stumge_sprite([[0,0,-1,0,0,-1],[0,0,-1,0,0,-1],[-1,0,-1,-1,0,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1]]),"?":new stumge_sprite([[-1,0,0,0,0,-1],[0,-1,-1,0,0,0],[-1,-1,0,0,0,-1],[-1,-1,0,0,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,0,0,-1,-1]])," ":new stumge_sprite([[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1]])},this.unknown_char=new stumge_sprite([[0,0,0,0,0,0],[0,-1,-1,-1,-1,0],[0,-1,-1,-1,-1,0],[0,-1,-1,-1,-1,0],[0,-1,-1,-1,-1,0],[0,0,0,0,0,0]])}putText(t,e,s){t=t.toUpperCase();let i=e;for(let e=0;e<t.length;e++){let a=t.charAt(e);a in this.font?(this.font[a].x=i,this.font[a].y=s,this.setSprite(this.font[a]),i=i+this.font[a].getWidth()+1):(this.unknown_char.x=i,this.unknown_char.y=s,this.setSprite(this.unknown_char),i=i+this.unknown_char.getWidth()+1)}}floodScreen(t){this.screen.fill(t)}setSprite(t){if(t instanceof stumge_sprite)for(let e=0;e<t.data.length;e++)for(let s=0;s<t.data[e].length;s++){let i=t.data[e][s];-1!==i&&t.x+s<stumge_width&&t.y+e<stumge_height&&this.setPixel(t.x+s,t.y+e,i)}}setPixel(t,e,s){let i=stumge_width*e+t;this.screen[i]=s}repaint(){let t=this.engine_shadow_context.createImageData(stumge_width,stumge_height);for(let e=0;e<stumge_width;e++)for(let s=0;s<stumge_height;s++){let i=stumge_width*s+e,a=4*i,n=this.palette[this.screen[i]];t.data[a]=n.r,t.data[a+1]=n.g,t.data[a+2]=n.b,t.data[a+3]=n.a}this.engine_shadow_context.putImageData(t,0,0),this.engine_context.drawImage(this.engine_shadow_canvas,0,0,stumge_width*this.scale,stumge_height*this.scale)}frame(){this.frame_count++,null!==this.update_function&&this.update_function(),this.repaint(),requestAnimationFrame(this.frame.bind(this))}init(t,e={}){this.scale="scale"in e?e.scale:1,this.engine_canvas=document.querySelector("canvas#stumge"),this.engine_context=this.engine_canvas.getContext("2d",{alpha:!1}),this.engine_context.canvas.width=stumge_width*this.scale,this.engine_context.canvas.height=stumge_height*this.scale,this.engine_context.imageSmoothingEnabled=!1,this.engine_shadow_canvas=document.createElement("canvas"),this.engine_shadow_canvas.width=stumge_width,this.engine_shadow_canvas.height=stumge_height,this.engine_shadow_context=this.engine_shadow_canvas.getContext("2d"),this.update_function=t,requestAnimationFrame(this.frame.bind(this))}changeKeyState(t){this.keyboard_state[t]++}keyDown(t){switch(t.key){case"Unindentified":break;case"ArrowUp":case"Up":this.changeKeyState(stumge_key_up);break;case"ArrowDown":case"Down":this.changeKeyState(stumge_key_down);break;case"ArrowLeft":case"Left":this.changeKeyState(stumge_key_left);break;case"ArrowRight":case"Right":this.changeKeyState(stumge_key_right);break;case"a":case"A":this.changeKeyState(stumge_key_button_1);break;case"s":case"S":this.changeKeyState(stumge_key_button_2);break;case"Control":this.changeKeyState(stumge_key_start);break;case"Alt":this.changeKeyState(stumge_key_select)}t.preventDefault()}keyUp(t){switch(t.key){case"Unindentified":break;case"ArrowUp":case"Up":this.keyboard_state[stumge_key_up]=0;break;case"ArrowDown":case"Down":this.keyboard_state[stumge_key_down]=0;break;case"ArrowLeft":case"Left":this.keyboard_state[stumge_key_left]=0;break;case"ArrowRight":case"Right":this.keyboard_state[stumge_key_right]=0;break;case"a":case"A":this.keyboard_state[stumge_key_button_1]=0;break;case"s":case"S":this.keyboard_state[stumge_key_button_2]=0;break;case"Control":this.keyboard_state[stumge_key_start]=0;break;case"Alt":this.keyboard_state[stumge_key_select]=0}t.preventDefault()}keyPressed(t){return this.keyboard_state[t]>0}keyPress(t){return 1===this.keyboard_state[t]&&(this.keyboard_state[t]=2,!0)}}